name: 'Terraform'
 

on:
  pull_request:
    branches:
    - main
    paths:
    - 'resource-groups/**'

defaults: 
  run: 
    working-directory: resource-groups


jobs:
    terraform-plan:

        runs-on: ubuntu-latest
        environment: production

        name: 'Terraform Plan'
        
        steps: 
          - name: Log in with Azure 
            uses: azure/login@v1
            with: 
              client-id: ${{ secrets.AZURE_AD_CLIENT_ID }}
              # client-secret: ${{ secrets.AZURE_AD_CLIENT_SECRET }}
              subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
              tenant-id: ${{ secrets.AZURE_AD_TENANT_ID }}
        
        

          - name: Checkout
            uses: actions/checkout@v3
            
          - name: Setup Terraform 
            uses: hashicorp/setup-terraform@v2
            with:
              terraform_wrapper: false
          
          - name: Terraform Init
            run: terraform init

          - name: Terraform Plan
            id: tf-plan
            run: terraform plan -no-color